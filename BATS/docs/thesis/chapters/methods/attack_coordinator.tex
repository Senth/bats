% !TEX root = ../../main.tex

\section{Attack coordinator}
The attack coordinator has one feature, that is to coordinate attacks. Squads can request attacks from the attack coordinator and it will search for a good location to attack. Before describing the algorithms, you need to know that attacks can be grouped into two categories: frontal attacks, and distracting attacks.

Frontal attacks are big attacks that generally use the majority of the army and attacks head on, distracting attacks are minor attacks either used to distract the enemy from one position to where the attack is (hence the name), or they can be used to try to deal some damage to the enemy, with heavy emphasis on try. These distracting attacks can be drops, harassment, counter-attacks—BATS has, in time of this writing, only implemented the drop functionality. It shall be noted that most of the distracting attacks are not suicide attacks, and some does not even have to deal any damage to be successful as the goal is to draw away the enemy forces from a well-defended area, our expansion, etc.

\paragraph{Where to attack?}
The attack coordinator uses two to three weight multiplied together to get the near optimal attack location—it shall be noted that it is not the optimal attack location and that the weights have not been extensively balanced. The attacking positions are derived from seen enemy structures and expansions that have not been scouted for some time.

The first weight, \emph{distance}, prioritizes structures (and location) far away from other existing attacks, including allied; it is a good idea to spread out multiple attack to split up the enemy army. The second weight, \emph{type}, determines how important a structure or location is to attack, and the third weight, \emph{defended}, is how well defended an area is—the defended weight is not implemented, but distracting attacks would use it to get a location that can be attacked without itself being attack, or not reaching the location because of well defended areas.

In addition to these weights, if the squad is a frontal attack and follows an allied squad, it will get an attack position near the allied squads target instead of using the weights.

Enemy armies are not included in the calculation, because one rarely gain anything on attack an army, one should find gaps in the defense instead\cite{day9}. While it would be good to engage and attack an enemy army if its a lot weaker than our BATS will still do that if the squad is close by, but it will not search for those small armies. Armies are also more mobile meaning it would be a lot harder to keep a track on them.

\subsection{Calculation of distance weight}
Distance weight is a simple calculation: if no other attacking squads (including allied) are present it defaults to 1. Otherwise the average from all other attacking squads are calculated as described in equation \ref{eq:distance_weight}.
\begin{equation}
\label{eq:distance_weight}
weight = \frac{\sum_{i=1}^{s}{distance(i)^2}}{s} \qquad \left\{s = \text{number of squads}\right.
\end{equation}
Here \emph{weight} is the average distance from all other attacking squads. The weight is then normalized to [0.0, 1.0], shown in equation \ref{eq:distance_weight_normalized}—dividing the weight with the maximum map distance. As with most distance calculations, they use the squared version because of faster calculation since no root calculations are needed.
\begin{equation}
\label{eq:distance_weight_normalized}
normalized\ weight = \frac{weight}{MAP\_WIDTH^2 + MAP\_HEIGHT^2}
\end{equation}


\subsection{Type weight}
This weight prioritizes different structures and locations. Most of the values here are fixed or calculated between fixed values (expansions). The structures and locations are presented in priority order below with the current values assign to them. These values are rough estimates what might be good, thus one shall not think these are \emph{the} values. Because of multiplying these values with other weights the difference between 0.1 and 0.2 is greater than 0.2 and 0.3 (0.2 is the double of 0.1).

\paragraph{Not scouted expansions 1.0\conf}
These are expansion that have not been visited for the last 150\conf seconds. The idea is to check expansions when moving out to attack, although the current version does not work as expected. Because the \nameref{sec:scout_squad} cannot cover all the areas quickly the attack squad will act more as a scout than attack squad because of visiting expansions in various location around the map. To fix this only the closest expansions to the enemy shall be checked and possibly only one with this squad, as this is roughly what Magnusson has observed when watching professional StarCraft players. This feature has been disable until it has been fixed.
	
\paragraph{Expansions [0.0, 1.0]\conf}
This expansion weight is for existing expansions of the enemy. The weight is higher for fresh expansions, this is done by checking how many minerals (in fractions) are left around the expansion—the \nameref{sec:resource_counter} keeps track of the minerals. The minimum value can, in addition to its normal state, be used as a kind of ceiling function; e.g. if it is set to ceil\conf and the value is 0.5 while only 20\% of the minerals are left it will ceil the weight to 0.5; see equation \ref{eq:weight_expansion_ceil}. If it is set to normal, the fraction will be normalized in the [0.5, 1.0] range, meaning the weight will be 0.6; see equation \ref{eq:weight_expansion_normal}.
\begin{equation}
\label{eq:weight_expansion_ceil}
weight =
\begin{cases}
minValue & if $fracMinerals(x) < minValue$ \\
fracMinerals(x) & if $fracMinerals(x) \geq minValue$
\end{cases}
\end{equation}
\begin{equation}
\label{eq:weight_expansion_normal}
weight = fracMinerals(x) \times (maxValue - minValue) + minValue
\end{equation}

\paragraph{Addons 0.4\conf}
Addons are structures built in connection to another structure and only exist for Terran. These are both upgrade structures and can make either the attached unit producing structure create advanced units (such as tanks), or all specific unit producing structures able to produce the unit—e.g. the addon Covert Ops for a Science Facility makes Ghosts available for production in all Barracks. The only exception to this is the addons to the Command Center which is either Comsat for detection or Nuclear Silo for nukes.

\paragraph{Supplies 0.35\conf}
Supplies are structures that provide space (or food) for more units to be created, see section \ref{sec:starcraft_supply} for how supplies work. This supply priority only makes sense for Terran as they work differently for the other classes: Protoss also uses their for powering buildings, i.e. a higher priority would be good here; for Zerg the supplies are increased by the Overlord unit, this would require an additional algorithm for searching for Overlords, the priority would be higher, but maybe even higher for only air attacks (not available in this version).

\paragraph{Upgrade structures 0.3\conf}
Upgrade structures are not all structures that can upgrade, Only structures that can upgrade some general attack and defense bonus are treated as upgrade structures. Meaning Terran Acadamy (which upgrades Stim for Marines) are not treated as an upgrade structure. The reason for this is because of simplicity; attack and defense upgrades come in three steps meaning there are 6–12 upgrades in total (depending on what structure) for that structure and is continued to be upgraded throughout the game. This means its a lot bigger chance that the building still is useful (for the enemy) even when attacking it later in the game, as opposed to Acadamy which upgrades are long done—although in this case medics and firebats could not be created by the enemy, but the enemy can simply prioritize marines in the meanwhile and not much harm would be done.

\paragraph{Unit producing structure 0.2\conf}
All structures that can produce units. These are not ordered in any specific order, not to say that it does not matter because it does, but it will always vary depending on the situation. If the enemy has 10 barracks and 1 Starport, it is probably best to destroy the Starport, whereas if the enemy has 1 barrack and 4 Starports it is probably best to destroy the barracks.

\paragraph{Other structures 0.1\conf}
Not much to say, all other structures that have not been covered, such as Terran Acadamy.

\subsubsection{Why this order?}
Because StarCraft is mostly about managing expansions\cite{day9}, the bot tries to deny and kill fresh expansions as its first priority (the top two priorities). Targeting addons can either stop the production of an important upgrade (siege mode for tanks) or the ability to create tanks, ghosts, etc. Delaying late game units is a big priority if it can be accomplished. Supply depots are almost always good to destroy since it halts all unit production, unless the enemy has stacked up lots of supplies (bad strategy in general) or lost many units in a recent battle. Stopping an upgrade is probably better than killing a unit producing structure, because if the upgrade finishes all existing units will get the upgrade, while if we kill a unit producing structure only 2–4 units will get stopped, but it depends on the type of unit producing structure, what upgrade structure etc; but this priority will do for now.

\subsection{Defended weight}


\subsection{Wait Goals}